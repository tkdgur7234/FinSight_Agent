{
  "name": "StockSense",
  "nodes": [
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -480,
        16
      ],
      "id": "f6a225f3-c4da-46ac-8036-4aa0b7d751de",
      "name": "When clicking â€˜Execute workflowâ€™"
    },
    {
      "parameters": {
        "url": "https://api.apiflash.com/v1/urltoimage",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "access_key",
              "value": "7c895cc29c9a4264bf1a8c8397affc34"
            },
            {
              "name": "url",
              "value": "https://finviz.com/map.ashx?t=sec"
            },
            {
              "name": "fomat",
              "value": "png"
            },
            {
              "name": "quality",
              "value": "100"
            },
            {
              "name": "width",
              "value": "1920"
            },
            {
              "name": "height",
              "value": "1080"
            },
            {
              "name": "response_type",
              "value": "image"
            },
            {
              "name": "element",
              "value": "#canvas-wrapper"
            },
            {
              "name": "wait_until",
              "value": "page_loaded"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -272,
        16
      ],
      "id": "25739b7b-ae5f-4ee2-aa46-65aa79996f08",
      "name": "s&p 500 map"
    },
    {
      "parameters": {
        "jsCode": "// 1. ì„¤ì •\nconst tickers = {\n  \"ë‹¤ìš° ì¡´ìŠ¤\": \"^DJI\",\n  \"S&P 500\": \"^GSPC\",\n  \"ë‚˜ìŠ¤ë‹¥\": \"^IXIC\",\n  \"ëŸ¬ì…€ 2000\": \"^RUT\",\n  \"WTI ì›ìœ \": \"CL=F\",\n  \"ê¸ˆ\": \"GC=F\",\n  \"ë¹„íŠ¸ì½”ì¸\": \"BTC-USD\",\n  \"ë¯¸ êµ­ì±„ 10ë…„\": \"^TNX\",\n  \"ë‹¬ëŸ¬ ì¸ë±ìŠ¤\": \"DX-Y.NYB\"\n};\n\nconst results = [];\nconst requests = [];\n\n// 2. ë¹„ë™ê¸° ìš”ì²­ ì¤€ë¹„ (ë³‘ë ¬ ì²˜ë¦¬ë¡œ ì†ë„ ìµœì í™”)\nfor (const [name, symbol] of Object.entries(tickers)) {\n  const url = `https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=2d`;\n  \n  // n8n ë‚´ì¥ HTTP Helper ì‚¬ìš©\n  const requestPromise = this.helpers.httpRequest({\n    method: 'GET',\n    url: url,\n    headers: {\n      'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/58.0.3029.110 Safari/537.3'\n    },\n    json: true\n  })\n  .then(response => {\n    // ì„±ê³µ ì‹œ ë°ì´í„° íŒŒì‹±\n    const meta = response.chart.result[0].meta;\n    const currentPrice = meta.regularMarketPrice;\n    const prevClose = meta.chartPreviousClose;\n\n    const changeAmount = currentPrice - prevClose;\n    const changePct = (changeAmount / prevClose) * 100;\n\n    const emoji = changePct >= 0 ? \"ğŸ”´\" : \"ğŸ”µ\";\n    const sign = changePct >= 0 ? \"+\" : \"\";\n\n    // í¬ë§·íŒ…\n    let priceStr = \"\";\n    if ([\"^TNX\", \"DX-Y.NYB\"].includes(symbol)) {\n      priceStr = currentPrice.toFixed(3);\n    } else if (symbol === \"BTC-USD\") {\n      priceStr = new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(currentPrice);\n    } else {\n      priceStr = new Intl.NumberFormat('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(currentPrice);\n    }\n\n    return `| ${name} | ${priceStr} | ${emoji} ${sign}${changePct.toFixed(2)}% |`;\n  })\n  .catch(error => {\n    // ì‹¤íŒ¨ ì‹œ ì—ëŸ¬ ë¡œê·¸ ë°˜í™˜\n    return `| ${name} | Error | âš ï¸ ${error.message} |`;\n  });\n\n  requests.push(requestPromise);\n}\n\n// 3. ëª¨ë“  ìš”ì²­ ë³‘ë ¬ ì‹¤í–‰ ë° ëŒ€ê¸°\nconst rows = await Promise.all(requests);\n\n// 4. í…Œì´ë¸” ìƒì„±\nlet markdownTable = \"| ì§€í‘œ | í˜„ì¬ê°€ | ë³€ë™ë¥  |\\n| :--- | :---: | :---: |\\n\";\nmarkdownTable += rows.join(\"\\n\");\n\nreturn [\n  {\n    json: {\n      market_summary_markdown: markdownTable\n    }\n  }\n];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -272,
        -128
      ],
      "id": "fc25c0c0-3447-4e4d-9742-fd00fb02562c",
      "name": "Indicators"
    },
    {
      "parameters": {
        "url": "https://api.stlouisfed.org/fred/releases/dates",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "api_key",
              "value": "f5bdb1b66a00ec81ec6b44282bcb12a8"
            },
            {
              "name": "file_type",
              "value": "json"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.3,
      "position": [
        -240,
        224
      ],
      "id": "e8962c5f-27c6-4016-9415-56c7f5927307",
      "name": "Fred CPI, PPI, PCE"
    },
    {
      "parameters": {
        "jsCode": "// 1. ì§€í‘œ ëª©ë¡\nconst indicators = {\n  \"DFEDTARU\": \"ê¸°ì¤€ê¸ˆë¦¬ (ìƒë‹¨)\",\n  \"CPIAUCSL\": \"ì†Œë¹„ìë¬¼ê°€ì§€ìˆ˜ (CPI)\",\n  \"PCEPI\": \"ê°œì¸ì†Œë¹„ì§€ì¶œ (PCE)\",\n  \"PPIFIS\": \"ìƒì‚°ìë¬¼ê°€ì§€ìˆ˜ (PPI)\",\n  \"PAYEMS\": \"ë¹„ë†ì—… ê³ ìš©ì§€ìˆ˜\",\n  \"ICSA\": \"ì‹¤ì—…ìˆ˜ë‹¹ ì²­êµ¬ê±´ìˆ˜\",\n  \"RSAFS\": \"ì†Œë§¤ íŒë§¤\"\n};\n\nconst apiKey = 'f5bdb1b66a00ec81ec6b44282bcb12a8'; \nconst requests = [];\n\n// 2. ìš”ì²­ ìƒì„± (realtime_start ì œê±° -> ë¬´ì¡°ê±´ ìµœì‹ ê°’ ì¡°íšŒ)\nfor (const [id, name] of Object.entries(indicators)) {\n  // sort_order=desc & limit=1 : ë‚ ì§œ ê¸°ì¤€ ê°€ì¥ ìµœì‹  ë°ì´í„° 1ê°œë§Œ ê°€ì ¸ì˜´\n  const url = `https://api.stlouisfed.org/fred/series/observations?series_id=${id}&sort_order=desc&limit=1&api_key=${apiKey}&file_type=json`;\n  \n  const req = this.helpers.httpRequest({ url: url, json: true })\n    .then(res => {\n      if (res.observations && res.observations.length > 0) {\n        const data = res.observations[0];\n        return {\n          name: name,\n          value: data.value,\n          date: data.date, // ì´ê²ƒì€ 'ê´€ì¸¡ ê¸°ì¤€ì¼'ì…ë‹ˆë‹¤. (ë°œí‘œì¼ X)\n          realtime_start: data.realtime_start // ì´ ë°ì´í„°ê°€ ì–¸ì œ DBì— ë“¤ì–´ì™”ëŠ”ì§€\n        };\n      }\n      return { name: name, value: \"N/A\", date: \"-\" };\n    })\n    .catch(err => ({ name: name, value: \"Error\", date: \"-\" }));\n\n  requests.push(req);\n}\n\n// 3. ê²°ê³¼ ì·¨í•©\nconst results = await Promise.all(requests);\n\n// 4. í…Œì´ë¸” ìƒì„±\nlet table = \"| ì§€í‘œëª… | í˜„ì¬ê°’ | ë°ì´í„° ê¸°ì¤€ì›”(ì¼) |\\n| :--- | :---: | :---: |\\n\";\n\nresults.forEach(item => {\n  // ë‚ ì§œ í¬ë§·íŒ… (ê°€ë…ì„±ì„ ìœ„í•´)\n  // CPIë‚˜ PCE ë“± ì›”ê°„ ì§€í‘œëŠ” ë³´í†µ '1ì¼'ë¡œ í‘œê¸°ë˜ë¯€ë¡œ 'YYYYë…„ MMì›”'ë¡œ í•´ì„í•˜ë©´ ë¨\n  let dateDisplay = item.date;\n  \n  // (ì˜µì…˜) ê°’ì´ ìˆìœ¼ë©´ í–‰ ì¶”ê°€\n  if (item.value !== \"N/A\" && item.value !== \"Error\") {\n    // ì²œë‹¨ìœ„ ì½¤ë§ˆ ì¶”ê°€\n    let valStr = Number(item.value).toLocaleString(undefined, {maximumFractionDigits: 2});\n    table += `| ${item.name} | **${valStr}** | ${dateDisplay} |\\n`;\n  }\n});\n\nreturn {\n  json: {\n    market_indicators_markdown: table,\n    raw_data: results\n  }\n};"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        64,
        176
      ],
      "id": "da48a99a-3983-4d93-9896-8b61727846b8",
      "name": "Code in JavaScript"
    }
  ],
  "pinData": {},
  "connections": {
    "When clicking â€˜Execute workflowâ€™": {
      "main": [
        [
          {
            "node": "Indicators",
            "type": "main",
            "index": 0
          },
          {
            "node": "s&p 500 map",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fred CPI, PPI, PCE": {
      "main": [
        []
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "04a144c0-5efe-4449-a320-b7be37867ad8",
  "meta": {
    "instanceId": "c77870e52b22371d6976dbe0373397fe2de8e3c415d1ab55a40a072637427ce8"
  },
  "id": "dAWLSDa0panmYQ2d",
  "tags": []
}